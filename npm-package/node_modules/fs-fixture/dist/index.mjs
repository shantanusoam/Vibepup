import p,{promises as i}from"fs";import n from"path";import u from"os";class h{path;constructor(t){this.path=t}exists(t=""){return i.access(n.join(this.path,t)).then(()=>!0,()=>!1)}rm(t=""){return i.rm(n.join(this.path,t),{recursive:!0,force:!0})}writeFile(t,e){return i.writeFile(n.join(this.path,t),e)}writeJson(t,e){return this.writeFile(t,JSON.stringify(e,null,2))}readFile(t,e){return i.readFile(n.join(this.path,t),e)}}const f=p.realpathSync(u.tmpdir()),l=`fs-fixture-${Date.now()}`;let a=0;function m(){return a+=1,a}const{hasOwnProperty:w}=Object.prototype,y=(r,t)=>w.call(r,t);function c(r,t){const e=[];for(const o in r){if(!y(r,o))continue;const s=r[o];typeof s=="string"?e.push({path:n.join(t,o),content:s}):e.push(...c(s,n.join(t,o)))}return e}async function F(r){const t=n.join(f,`${l}-${m()}`);return await i.mkdir(t,{recursive:!0}),r&&(typeof r=="string"?await i.cp(r,t,{recursive:!0}):typeof r=="object"&&await Promise.all(c(r,t).map(async e=>{await i.mkdir(n.dirname(e.path),{recursive:!0}),await i.writeFile(e.path,e.content)}))),new h(t)}export{F as createFixture};
